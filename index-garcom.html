<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <title>Santo Lanche - Pedido do Gar√ßom</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <!-- Tailwind CSS via CDN -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- React 18 e ReactDOM via CDN -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>

    <!-- Babel para entender JSX no navegador -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  </head>
  <body class="bg-gray-50">
    <div id="root"></div>

    <script type="text/babel">
      const { useState, useEffect } = React;

      function GarcomApp() {
        const WHATSAPP_NUMBER = "5511921789893"; // DDI+DDD+n√∫mero, sem espa√ßos

        const [mesa, setMesa] = useState(new URLSearchParams(window.location.search).get('mesa') || "1");
        const [cart, setCart] = useState([]);
        const [isCartOpen, setIsCartOpen] = useState(false);
        const [orderConfirmed, setOrderConfirmed] = useState(null);

        const sampleProducts = [
          {
            id: "santo-burguer-simples",
            name: "Santo Burguer",
            description: "P√£o Australiano, smash de 90g, cheddar fatiado, alface, tomate, molho da casa.",
            price: 19.0,
            img: "/imagens/santo-burguer.jpeg",
            tags: ["Lanches"],
          },
          {
            id: "oklahoma-smash-simples",
            name: "Oklahoma Smash",
            description: "P√£o brioche, smash de 90g prensado com cebola, queijo prato, picles, molho da casa.",
            price: 20.0,
            img: "/imagens/oklahoma-smash.jpeg",
            tags: ["Lanches"],
          },
          // Adicionar outros produtos aqui...
        ];

        // Adiciona item ao carrinho
        function addToCart(product, qty = 1) {
          setCart((prev) => {
            const existing = prev.find((p) => p.id === product.id);
            if (existing) {
              return prev.map((p) =>
                p.id === product.id ? { ...p, qty: p.qty + qty } : p
              );
            }
            return [...prev, { ...product, qty }];
          });
          setIsCartOpen(true);
        }

        // Remover item do carrinho
        function removeFromCart(id) {
          setCart((prev) => prev.filter((p) => p.id !== id));
        }

        // Enviar pedido para Google Sheets
        function handleCheckout(form) {
          const order = {
            id: `PED-${Date.now()}`,
            items: cart,
            customer: form,
            mesa: mesa,
            createdAt: new Date().toISOString(),
          };

          // Dados do pedido
          const payload = {
            id: order.id,
            customer: form,
            items: order.items,
            subtotal: order.items.reduce((total, item) => total + item.price * item.qty, 0),
            deliveryFee: 0, // Frete gr√°tis ou outro valor
            total: order.items.reduce((total, item) => total + item.price * item.qty, 0),
          };

          // Envio para o Google Sheets via Apps Script
          const url = "https://script.google.com/macros/s/AKfycbx53qSq_E9BGeuLQa-qvxnYtcnYGSCUFMzBLDlItMvjsxo4E12wEM-LV87041yrWiXO8g/exec";
          fetch(url, {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify(payload),
          })
            .then((response) => response.text())
            .then((text) => {
              console.log("Pedido enviado para o Google Sheets:", text);
              setOrderConfirmed(order);
              setCart([]); // Limpa o carrinho ap√≥s envio
            })
            .catch((error) => console.error("Erro ao enviar pedido:", error));
        }

        return (
          <div className="min-h-screen bg-gray-50 text-gray-900">
            <header className="bg-white shadow">
              <div className="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8">
                <div className="flex justify-between items-center py-4">
                  <div className="flex items-center gap-4">
                    <div className="rounded-full bg-yellow-400 w-12 h-12 flex items-center justify-center font-bold text-white">
                      üçî
                    </div>
                    <div>
                      <h1 className="text-xl font-extrabold">Santo Lanche</h1>
                      <p className="text-sm text-gray-500">Pedido - Mesa {mesa}</p>
                    </div>
                  </div>
                </div>
              </div>
            </header>

            <main className="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
              <section className="grid grid-cols-1 md:grid-cols-3 gap-8">
                <div className="md:col-span-2">
                  <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
                    {sampleProducts.map((p) => (
                      <article key={p.id} className="bg-white rounded-lg shadow overflow-hidden flex flex-col">
                        <img src={p.img} alt={p.name} className="w-full h-44 object-cover" />
                        <div className="p-4 flex-1 flex flex-col">
                          <div>
                            <h4 className="font-bold text-lg">{p.name}</h4>
                            <p className="text-sm text-gray-600 mt-1">{p.description}</p>
                          </div>
                          <div className="mt-4 flex items-end justify-between">
                            <div className="flex items-center gap-2">
                              <span className="text-xl font-extrabold">R$ {p.price.toFixed(2).replace(".", ",")}</span>
                              <span className="text-xs text-gray-500">/ un</span>
                            </div>
                            <button
                              onClick={() => addToCart(p, 1)}
                              className="bg-green-600 text-white px-3 py-2 rounded-md text-sm font-semibold"
                            >
                              Adicionar
                            </button>
                          </div>
                        </div>
                      </article>
                    ))}
                  </div>

                  <div className="mt-8 flex flex-col items-start">
                    <button
                      onClick={() => handleCheckout({ name: "Gar√ßom", phone: "123456789", address: "Mesa " + mesa, payment: "dinheiro" })}
                      className="px-4 py-2 rounded-md text-sm font-semibold bg-indigo-600 text-white"
                    >
                      Finalizar Pedido
                    </button>
                  </div>
                </div>
              </section>
            </main>
          </div>
        );
      }

      const root = ReactDOM.createRoot(document.getElementById("root"));
      root.render(<GarcomApp />);
    </script>
  </body>
</html>
